{% load static %}
<!DOCTYPE html>
<html style="font-size: 16px;" lang="fr">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="Product 1 Title">
  <meta name="description" content="">
  <title>Product Details Template</title>
  <link rel="stylesheet" href="{% static 'metasouk/css/site.css' %}" media="screen">
  <link rel="stylesheet" href="{% static 'metasouk/css/Product-Details-Template.css' %}" media="screen">
  <script class="u-script" type="text/javascript" src="{% static 'metasouk/js/jquery.js' %}" defer=""></script>
  <script class="u-script" type="text/javascript" src="{% static 'metasouk/js/site.js' %}" defer=""></script>
  <link id="u-theme-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <link id="u-page-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,500,500i,700,700i|Merriweather:300,300i,400,400i,700,700i,900,900i|Alata:400">
</head>

<body data-path-to-root="../" data-include-products="true" class="u-body u-xl-mode" data-lang="fr">
  {% include "metasouk/includes/header.html" %}
  <section class="u-align-center u-clearfix u-container-align-center u-grey-80 u-section-1" id="block-1">
    <div class="u-clearfix u-sheet u-sheet-1">
      <div class="u-container-style u-expanded-width u-gradient u-product u-product-1">
        <div style="position: absolute; top: 20px; right: 20px;">
          <button onclick="toggleReportForm()"
            style="background-color: transparent; color: #cc0000; border: 1px solid transparent; padding: 6px 14px; font-size: 14px; border-radius: 20px; cursor: pointer; transition: 0.3s;">
            Signaler
          </button>
        </div>
        <!-- Signalement -->
        <div id="reportForm"
          style="display: none; position: absolute; top: 60px; right: 20px; background-color: #fff; border: 1px solid #ddd; padding: 20px; border-radius: 10px; width: 280px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: Arial, sans-serif; z-index: 100;">
          <h4 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #444;">Signaler un problème</h4>
          <form style="font-size: 14px; color: #333;" method="post">
            {% csrf_token %}
            <input type="hidden" name="action_type" value="signaler">
            <div style="margin-bottom: 10px;">
              <label style="display: flex; align-items: center;">
                <input type="checkbox" name="reason" value="inapproprié" style="margin-right: 8px;">
                Contenu inapproprié
              </label>
            </div>
            <div style="margin-bottom: 10px;">
              <label style="display: flex; align-items: center;">
                <input type="checkbox" name="reason" value="arnaque" style="margin-right: 8px;">
                Arnaque
              </label>
            </div>
            <div style="margin-bottom: 10px;">
              <label style="display: flex; align-items: center;">
                <input type="checkbox" name="reason" value="droits" style="margin-right: 8px;">
                Violation de droits d’auteur
              </label>
            </div>

            <div style="margin-bottom: 15px;">
              <label for="autre">Autre :</label>
              <textarea name="autre" id="autre" rows="3" placeholder="Votre message ici..."
                style="width: 100%; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; padding: 6px;"></textarea>
            </div>

            <div style="text-align: right;">
              <button type="submit"
                style="background-color: #f99c00; color: white; border: none; padding: 8px 16px; border-radius: 6px; margin-right: 8px; cursor: pointer;">Envoyer</button>
              <button type="button" onclick="toggleReportForm()"
                style="background-color: #aaa; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Annuler</button>
            </div>
          </form>
        </div>

        <div class="u-container-style u-expanded-width u-gradient u-product u-product-1">
          <div class="u-container-layout u-container-layout-1">
            <!-- Image du produit -->
            <div
              class="custom-expanded u-carousel u-gallery u-layout-thumbnails u-lightbox u-no-transition u-product-control u-show-text-none u-thumbnails-position-left u-gallery-1"
              data-interval="5000" data-u-ride="carousel" id="carousel-0a05">
              <div class="u-carousel-inner u-gallery-inner u-gallery-inner-1" role="listbox">
                <div class="u-carousel-item u-gallery-item u-active">
                  <div class="u-back-slide">
                    <img class="u-back-image u-expanded u-image-contain" src="{{ produit.image.url }}"
                      alt="{{ produit.nom }}">
                  </div>
                </div>
              </div>
              <ol class="u-carousel-thumbnails u-spacing-15 u-vertical-spacing u-carousel-thumbnails-1">
                <li class="u-carousel-thumbnail u-carousel-thumbnail-1 u-active"
                  data-u-target="#carousel-{{ produit.id }}" data-u-slide-to="0">
                  <img class="u-carousel-thumbnail-image u-image" src="{{ produit.image.url }}" alt="{{ produit.nom }}">
                </li>
              </ol>
            </div>
            <!-- Détails -->
            <h2
              class="u-align-left u-custom-font u-font-ubuntu u-product-control u-text u-text-default u-text-white u-text-1">
              {{ produit.nom }}</h2>
            <div class="u-border-3 u-border-custom-color-3 u-line u-line-horizontal u-opacity u-opacity-40 u-line-1">
            </div>
            <!-- Prix -->
            <div data-add-zero-cents="true" class="u-align-right u-product-control u-product-price u-product-price-1">
              <div class="u-price-wrapper u-spacing-21">
                <div class="u-old-price u-text-palette-2-base"
                  style="font-weight: 700; font-size: 1.25rem; text-decoration: line-through !important; letter-spacing: 6px; line-height: 1.04;">
                </div>
                <div class="u-price u-text-custom-color-3" style="font-size: 1.875rem; font-weight: 700;">
                  ${{produit.prix }}</div>
              </div>
            </div>
            <form method="post" action="{% url 'ajouter_au_panier' produit.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-success"
                style="margin-left: 700px;
                background-color: #f99c00; color: white; border: none; border-radius: 20px; padding: 10px; font-weight: bold;width:20%;">
                Add to cart
              </button>
            </form>

            <!-- Description -->
            <div class=" u-align-center u-product-control u-product-desc u-text u-text-body-alt-color u-text-2">
              {{ produit.description }}
            </div>

            <!-- Evaluation -->
            <form method="post" id="rating-form">
              {% csrf_token %}
              <input type="hidden" name="action_type" value="evaluer">
              <input type="hidden" name="note" id="note-value" value="{{ evaluation_utilisateur|default_if_none:'' }}">

              <div class="rating-container" style="text-align:center;">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
              </div>

              <div style="text-align: center; margin-top: 10px;">
                <button type="submit"
                  style="padding: 8px 16px; background-color: #f0ad4e; color: white; border: none; border-radius: 4px; margin-top: 20px;margin-left: 520px;">Noter</button>
              </div>
            </form>
            <style>
              .rating-container {
                text-align: center;
                margin-top: 20px;
                margin-left: 45%;
              }

              .star {
                font-size: 2rem;
                color: #ccc;
                cursor: pointer;
                transition: color 0.3s;
              }

              .star.selected {
                color: #f0ad4e;
              }
            </style>
          </div>
        </div>
      </div>
    </div>

    <!-- Commentaire -->
    <div class="comment-section">
      <h3>Commentaires</h3>

      <!-- Formulaire -->
      <div class="comment-form">
        <form method="POST" style="width: 100%;">
          {% csrf_token %}
          <input type="text" name="contenu" placeholder="Ajouter un commentaire..." required style="width: 800px;" />
          <button type="submit">Envoyer</button>
        </form>
      </div>

      <!-- Liste des commentaires -->
      <div class="comments-list">
        {% for commentaire in commentaires %}
        <div class="comment">
          <div class="avatar">
            <img src="{% static 'metasouk/images/avatar.jpg' %}" alt="avatar">
          </div>
          <div class="content">
            <strong>{{ commentaire.auteur.username }}</strong><br />
            {{ commentaire.contenu }}<br />
          </div>
        </div>
        {% empty %}
        <p>Aucun commentaire pour ce produit.</p>
        {% endfor %}
      </div>
    </div>
  </section>

  {% include "metasouk/includes/footer.html" %}
</body>
<script>
  const stars = document.querySelectorAll('.star');
  const noteInput = document.getElementById('note-value');

  function colorStars(note) {
    stars.forEach((star, i) => {
      star.classList.toggle('selected', i < note);
    });
  }

  // Lecture note existante
  const existingNote = parseInt(noteInput.value) || 0;
  colorStars(existingNote);

  // Toujours activer la modification : au clic, changer la note et recolorer les étoiles
  stars.forEach((star, index) => {
    star.addEventListener('click', () => {
      const newNote = index + 1;
      noteInput.value = newNote;
      colorStars(newNote);
    });
  });
</script>
<script>
  function toggleReportForm() {
    const form = document.getElementById("reportForm");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
  }

  function submitReport() {
    alert("Merci pour votre signalement !");
    document.getElementById("reportForm").style.display = "none";
  }
</script>

</html>